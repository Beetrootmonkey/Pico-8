pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--ld42 game jam entry
--by beetrootmonkey

--@import lib

p = {}

function addlava(t)
  if t.id >= 5 and t.id <= 5 then
    mset(t.x, t.y, 4)
  elseif t.id >= 2 and t.id <= 4 then
    mset(t.x, t.y, t.id-1)
  end
end

function getislandedgetiles()
  local tiles = gettilesnotoftype(1)
  local new = {}
  for i = 1, #tiles do
    if #getneighboursoftype(tiles[i].x, tiles[i].y, 1) > 0 then
      new[#new+1] = tiles[i]
    end
  end
  return new
end

function getlavaedgetiles()
  local tiles = gettilesoftype(1)
  local new = {}
  for i = 1, #tiles do
    if #getneighboursnotoftype(tiles[i].x, tiles[i].y, 1) > 0 then
      new[#new+1] = tiles[i]
    end
  end
  return new
end

function gettilesoftype(type)
  local tiles = {}
  for i = 0, 15 do
    for j = 0, 15 do
      local t = gettile(i, j)
      if t.id == type then
        tiles[#tiles+1] = t
      end
    end
  end
  return tiles
end

function gettilesnotoftype(type)
  local tiles = {}
  for i = 0, 15 do
    for j = 0, 15 do
      local t = gettile(i, j)
      if t.id ~= 0 and t.id ~= type then
        tiles[#tiles+1] = t
      end
    end
  end
  return tiles
end

function getneighboursoftype(x, y, type)
  local n = getneighbours(x, y)
  local new = {}
  for i = 1, #n do
    if n[i].id ~= 0 and n[i].id == type then
      new[#new+1] = n[i]
    end
  end
  return new
end

function getneighboursnotoftype(x, y, type)
  local n = getneighbours(x, y)
  local new = {}
  for i = 1, #n do
    if n[i].id ~= 0 and n[i].id ~= type then
      new[#new+1] = n[i]
    end
  end
  return new
end

function getneighbours(x, y)
  local top = gettile(x, y-1)
  local left = gettile(x-1, y)
  local right = gettile(x+1, y)
  local bot = gettile(x, y+1)
  return {top, left, right, bot}
end

function gettile(tx, ty)
  return {id = mget(tx, ty), x = tx, y = ty}
end

function _init()
  p.x = 20
  p.y = 20
  p.w = -1
  p.ll = 0
  p.lu = 0
end

function _update()
  -- Player controls
  local walking = false
  if btn(1) then
    p.x = p.x+1
    walking = true
    p.ll = 0
  end
  if btn(3) then
    p.y = p.y+1
    walking = true
    p.lu = 0
  end
  if btn(0) then
    p.x = p.x-1
    walking = true
    p.ll = 1
  end
  if btn(2) then
    p.y = p.y-1
    walking = true
    p.lu = 1
  end

  if walking then
    p.w += 0.5
    p.w %= 4
  else
    p.w = -1
  end

  -- Lava update
  local tiles = getislandedgetiles()
    if #tiles > 0 then
      local index = flr(rnd(#tiles)+1)
      addlava(tiles[index])
    end

end

function _draw()
  cls()
  map()
  print(p.ll)
  print(p.lu)
  local sprite = 69 + 16 * p.lu
  if p.w ~= -1 then
     sprite += 1 + flr(p.w)
  end
  spr(sprite, p.x-4, p.y-4, 1, 1, p.ll == 1)
  --pset(p.x, p.y, 7)

end

__gfx__
00000000999999995555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999995999999555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999999995999999555999955555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999999995999999555999955555995555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000999999995999999555999955555995555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999999995999999555999955555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999995999999555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999995555555555555555555555555555555500000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555ddd555dddddd555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005566ddd55d66ddd555555b55555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005d66ddd55d66ddd555553555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005dddddd55dddddd555b53555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000005dddddd55dd6dd6555533b55555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055dddd555dddddd555533555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000555555555555555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000077000000770000007700000077000000000000000000000000000000000000000000000000000000000000000000000000000
000000000007700000077000007cc700007bb70000788700007ff700000000000000000000000000000000000000000000000000000000000000000000000000
000000000076d700007aa70007c7cc7007b7bb700787887007f7ff70000000000000000000000000000000000000000000000000000000000000000000000000
00000000007dd700007aa70007cccc7007bbbb700788887007ffff70000000000000000000000000000000000000000000000000000000000000000000000000
000000000007700000077000007cc700007bb70000788700007ff700000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000077000000770000007700000077000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0999999000aa99000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09aa999000aa99009aa99999000000000000000000ffff0000ffff0000ffff0000ffff0000ffff00000000000000000000000000000000000000000000000000
09aa9a9000999a009aa99a99000000000000000004f1f10004f1f10004f1f10004f1f10004f1f100000000000000000000000000000000000000000000000000
099999900099990099229922000000000000000004dfff0004dfff0004dfff0004dfff0004dfff00000000000000000000000000000000000000000000000000
09929920009292009999a999000000000000000000dfff000dffffd000dfff0000fdff0000dfff00000000000000000000000000000000000000000000000000
0999a990009292000000000000000000000000000010010000100000000001000000010000100000000000000000000000000000000000000000000000000000
000000000099a9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000ffff0000ffff0000ffff0000ffff0000ffff00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000044ff000044ff000044ff000044ff000044ff00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000044fd000044fd000044fd000044fd000044fd00000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000fffd0000ffdf0000fffd0000ffffd000fffd00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000010010000100000000001000000010000100000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010101010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105050505050505050505050505050101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
